给图片加密，除简单的文字水印版本

参考：流媒体平台的视频加密--防盗录的思路主要是对盗录者进行溯源

普通图文水印：视频转码时，编码到画面中的图片或文字水印--巨额的转码和存储成本

播放端浮动水印：视频播放时，覆盖在视频图层上的水印--分离并爬走原始

1.溯源水印的原理
1.1
生成 AB 流
为原始视频转码输出 A 流和 B 流两个副本，其中：
·A 流和 B 流均为 HLS 或 DASH 格式，各 TS 长度相等且时间对齐；
·A 流和 B 流被打上的水印内容有所不同。
·有了被分片的 A 流和 B 流后，我们可以这么推导：如果把 A 流当做0的序列，B 流当做1的序列，只要让每个观看者看到的视频是独一无二的0/1（也就是 A/B）序列的组合，就能做到“千人千面”的效果。

<img width="1280" height="534" alt="image" src="https://github.com/user-attachments/assets/304405e6-37d3-44e8-8a81-90374a52b615" />

图片实现：
✅ 溯源识别（fingerprinting）
✅ 版权防护
✅ 隐私内容保护
✅ 千人千图分发

将原图按网格划分为 N x M 块
如：8 × 8 → 得到 64 个小图块

为每个图块生成两个版本：

A 块：正常内容或某种水印

B 块：嵌入隐写水印或微小扰动（例如 DCT、图案变化）

用户 fingerprint → 二进制序列：如 010011...  【每个用户根据 ID Hash 生成指纹序列--这个也要存储和处理】

最终图像合成规则：
（1）如果 fingerprint 第 i 位是 0，用 A_i 块；如果是 1，用 B_i 块
（2）拼成一张完整图像 → 用户唯一副本

2.嵌入的图像隐写

2.1:LSB的实现：（像素空间-空域嵌入-但是对压缩、滤波等图像处理操作较为敏感。）
原理：https://cloud.tencent.com/developer/article/2159633   “图像隐写，如何在图像中隐藏二维码”  

`将图像根据RGB分为7-0个位平面，因为数学原理，只对M1-M7进行合成，得到的A0与A的差距最多为1，因此我们可以让A1≈A，图像A1的第0个位平面（M0）可以用于隐藏数据。`

技术点不同：（ OpenCV + Python）



2.2:DCT/DWT 隐写水印（图像的变换域-频域嵌入-压缩、裁剪等处理具有良好的鲁棒性）
https://blog.csdn.net/weixin_42315569/article/details/147706996

3.如何表示水印信息：二进制编码、特殊的标记或是其他编码方案
水印信息需要包含什么...

3.1考虑到数据的冗余性和纠错能力，以确保在被攻击或修改后仍能被检测出来。

4.水印检测
盲检测和非盲检测。盲检测不需要原始宿主数据，而非盲检测则需要。
盲检测更适用于实际应用，因为它不需要存储或传输原始数据
--just：嵌入水印的算法和参数
`一个鲁棒的水印系统应该能够抵抗常见的图像处理操作，如压缩、裁剪、滤波等，并且还应具备良好的可扩展性，以便适用于不同的媒体类型和格式。`

鲁棒性（Robustness）：指水印在经历常规图像处理后仍可被提取的能力：

·格式转换：JPEG→PNG→WEBP等转码
·有损压缩：质量因子≥60%的JPEG压缩
·色彩调整：亮度/对比度/饱和度变化±30%
·尺寸缩放：分辨率变化在50%-200%范围内

solve：
1.冗余编码技术
2.达到水印容量与隐蔽性的平衡。

评估标准通常包括误码率（BER）和信噪比（SNR）。
BER:误码率指的是在检测水印时发生错误的位数与总位数之比
SNR:信噪比则反映了水印信号相对于攻击噪声的强度。

✅ 具有高SNR的同时保持较低的BER。

一、采用方法：
1. 分层嵌入策略
采用三重混合域嵌入技术，结合不同域的特性：

嵌入层	技术实现	抗攻击特性	不可见性
空间域	LSB(最低有效位)隐写	抵抗格式转换	极高 ★★★★
频域(DCT)	中频系数调制	抵抗压缩/裁剪	高 ★★★☆
特征域	SIFT关键点绑定	抵抗旋转/缩放	中 ★★☆☆

<img width="1210" height="396" alt="image" src="https://github.com/user-attachments/assets/b359d285-a77e-4386-980d-9d74dffdc332" />
2. 水印内容生成
采用密码学绑定技术确保唯一性与防伪：
```
水印ID = HMAC-SHA256(
    UserID + "|" + 
    ImageID + "|" + 
    Timestamp + "|" + 
    SecretSalt
)[0:32]  // 截取32字符唯一标识
```
3. 抗攻击增强设计
3.1冗余嵌入：

在图像中随机选择50+个嵌入区域

每个区域重复嵌入完整水印3次

使用(7,4)汉明码纠错

3.2几何不变性：
```
# 伪代码：特征点相对位置嵌入
keypoints = detect_sift_features(img)
anchor = find_central_keypoint(keypoints)
for kp in radial_sorted_keypoints(anchor):
    distance = calc_normalized_distance(anchor, kp)
    angle = calc_angle(anchor, kp)
    embed_watermark_at(distance, angle, watermark_bit)
```
3.3抗机器学习去除：

添加对抗性噪声：$noise = \alpha \cdot sign(\nabla_x J(\theta, x, y))$

动态扰动模式：基于水印内容生成随机扰动场

二、水印检测与提取:
1. 多阶段检测流程
    可疑图片->>预处理： 标准化(512px, 75%质量)
    预处理->>特征提取： SIFT关键点检测
    预处理->>频域分析： DCT分块变换
    预处理->>空间分析： LSB位平面扫描
    特征提取-->>投票决策： 几何约束水印
    频域分析-->>投票决策： 频域系数解码
    空间分析-->>投票决策： LSB位重组
    投票决策->>结果： 汉明码纠错输出
2.安全增强措施
动态密钥轮换：
```
func GetDailySecret() []byte {
    daySeed := time.Now().Format("2006-01-02")
    return hmacSha256(masterKey, daySeed)
}
```
五、性能优化策略
智能分级处理：
<img width="1120" height="814" alt="image" src="https://github.com/user-attachments/assets/6a764aed-eab7-40f7-8592-a31df35de2f0" />





